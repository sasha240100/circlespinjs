!function(t){t.fn.circlespin=function(e){var n=t(this);n.parent().prepend(n.clone().css({visibility:"hidden",position:"absolute"}).attr("id","spincopy"));var i,o,s=t.extend({width:n.parent().find("#spincopy").width(),height:n.parent().find("#spincopy").height(),left:n.parent().find("#spincopy").offset().left-t(document).scrollLeft(),top:n.parent().find("#spincopy").offset().top-t(document).scrollTop(),preangle:0,autoupdate:!1},e),r=!1,c={left:!1,right:!1,top:!1,bottom:!1},l=this,p=0;return this.updateSettings=function(e){return s=t.extend({width:s.width,height:s.height,left:s.left,top:s.top,preangle:s.preangle},e),this.each(function(){return this})},s.autoupdate&&t(window).on("resize scroll spinning orientationchange scrollstop",function(){l.updateSettings({width:n.parent().find("#spincopy").width(),height:n.parent().find("#spincopy").height(),left:n.parent().find("#spincopy").offset().left-t(document).scrollLeft(),top:n.parent().find("#spincopy").offset().top-t(document).scrollTop(),preangle:s.preangle,autoupdate:!0}),console.log(s)}),this.startposUpdate=function(t){if(r){var e={left:!1,right:!1,top:!1,bottom:!1};t.clientX>=s.left&&t.clientX<s.left+.5*s.width&&(e.left=!0),t.clientX<=s.left+s.width&&t.clientX>s.left+.5*s.width&&(e.right=!0),t.clientY>=s.top&&t.clientY<s.top+.5*s.height&&(e.top=!0),t.clientY<=s.top+s.height&&t.clientY>s.top+.5*s.height&&(e.bottom=!0)}return e},this.getDegrees=function(t){var e=t.css("-webkit-transform")||t.css("-moz-transform")||t.css("-ms-transform")||t.css("-o-transform")||t.css("transform");if("none"!==e)var n=e.split("(")[1].split(")")[0].split(","),i=n[0],o=n[1],s=Math.round(Math.atan2(o,i)*(180/Math.PI));else var s=0;return 0>s&&(s+=360),s},this.setAngle=function(e){return t(n).css({transform:"rotate("+e+"deg)"}),this.each(function(){return this})},this.getResult=function(t,e){return t+p/360*(e-t)},this.getAngle=function(){return l.getDegrees(n)},t(this).on("mousedown vmousedown",function(e){l.each(function(){t(this).trigger("spinstart",this)}),r=!0,c={left:!1,right:!1,top:!1,bottom:!1},i={x:e.clientX,y:e.clientY},o={x:e.clientX,y:e.clientY},c=l.startposUpdate(e),t(n).css({cursor:"-webkit-grabbing"})}),t(document).on("mouseup vmouseup",function(e){r&&l.each(function(){t(this).trigger("spinend",this)}),r=!1,t(n).css({cursor:"-webkit-grab"}),c=l.startposUpdate(e)}),t(document).on("mousemove vmousemove",function(e){if(r){l.each(function(){t(this).trigger("spinning",this)});var i={x:0,y:0},h={x:0,y:0},a={x:0,y:0};i.x=o.x-s.left-.5*s.width,i.y=o.y-s.top-.5*s.height,h.x=e.clientX-s.left-.5*s.width,h.y=e.clientY-s.top-.5*s.height,a.x=e.clientX-o.x,a.y=e.clientY-o.y,i["long"]=Math.sqrt(i.x*i.x+i.y*i.y),h["long"]=Math.sqrt(h.x*h.x+h.y*h.y);var f=!0;c=l.startposUpdate(e),1==c.left&&1==c.top?o.y/e.clientY*e.clientX>=o.x?f=!0:o.y/e.clientY*e.clientX<o.x&&(f=!1):1==c.top&&1==c.right?e.clientY/o.y*e.clientX<=o.x?f=!1:e.clientY/o.y*e.clientX>o.x&&(f=!0):1==c.right&&1==c.bottom?o.y/e.clientY*e.clientX<=o.x?f=!0:o.y/e.clientY*e.clientX>o.x&&(f=!1):1==c.left&&1==c.bottom&&(e.clientY/o.y*e.clientX<=o.x?f=!0:e.clientY/o.y*e.clientX>o.x&&(f=!1));var u=(i.x*h.x+i.y*h.y)/(i["long"]*h["long"]),g=360*(1-u);f||(g=-g),p+=2*g;for(var d=p+s.preangle;p>360;)p-=360;for(;0>p;)p+=360;t(n).css({transform:"rotate("+d+"deg)"}),o={x:e.clientX,y:e.clientY}}}),this.each(function(){return this})}}($);